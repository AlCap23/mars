<!-- DO NOT EDIT THIS FILE! IT IS AUTOMATICALLY GENERATED BY rst2marshtml //-->
<!DOCTYPE html>
<html>
  <head>
    <title>MARS Simulator</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="description" content="MARS is a flexible physics simulator.">
    <meta name="author" content="MARS Project">
    <meta name="keywords" content="MARS, simulation, physics, robotics">
    <link rel="stylesheet" type="text/css" href="../../css/mars_default.css" media="all" />
  </head>
<body>
  <div class="nav-box">
    <h2>Navigation</h2>
    <nav>
      <ol>
        <li><a href="../../index.html">Home</a></li>
      </ol>
    </nav>
  </div>
  <div id="content">
  <header>
    <a href="../../index.html"><img src="../../images/logo_v2_wob.png" alt="MARS" /></a>
  </header>
<div class="document" id="basic-modeling-tutorial">
<h1 class="title">Basic Modeling Tutorial</h1>
<div class="section" id="introduction">
<h1>Introduction</h1>
<p>In this tutorial you will learn how to build a simple model of a robot
in Blender and how to export it to MARS.</p>
</div>
<div class="section" id="prerequisites">
<h1>Prerequisites</h1>
<p>We assume you already have a MARS development environment setup in
&quot;~/devel/&quot;.  You should also have a recent version of Blender
installed (we use 2.62 in this tutorial).</p>
</div>
<div class="section" id="blender-basics">
<h1>Blender Basics</h1>
<p>Blender's shortcuts and hotkeys depend on the context in which they
are triggered.  The context is usually determined by the mouse cursor.
That means that a certain hotkey, &quot;alt+p&quot; for example, will have
different meanings depending on the position of the mouse.  When the
mouse is hovering the 3D-View the hotkey &quot;alt+p&quot; will break up
child-parent relations, when hovering the text editor it will run the
current script.</p>
<div class="section" id="d-view-shortcuts-and-hotkeys">
<h2>3D-View Shortcuts and Hotkeys</h2>
<dl class="docutils">
<dt>rotate view</dt>
<dd>middle mouse button</dd>
<dt>move view</dt>
<dd>shift + middle mouse button</dd>
<dt>zoom view</dt>
<dd>mouse wheel or ctrl + middle mouse button</dd>
<dt>move object (grab)</dt>
<dd>g</dd>
<dt>rotate object</dt>
<dd>r</dd>
<dt>scale object</dt>
<dd>s</dd>
<dt>restrict move/rotate/scale axis</dt>
<dd>Press x, y, or z while moving/rotating/scaling.  If you press the same
axis again it will select the local axis.  Pressing a third time will
deselect the axis.</dd>
<dt>open toolbar</dt>
<dd>n</dd>
<dt>select object</dt>
<dd>right click</dd>
<dt>select multiple objects</dt>
<dd>shift + right click or &quot;b&quot; and drag a selection box</dd>
<dt>set parent object</dt>
<dd>first select child, then the parent (shift + right click), then press &quot;ctrl+p&quot;</dd>
</dl>
</div>
<div class="section" id="rescaling-objects">
<h2>Rescaling Objects</h2>
<p>If you edit the dimensions of an object in &quot;object mode&quot; you might
notice that the scale changes automatically.  This is because in
object mode you do not really change the object's vertices.  To apply
the changes you did in &quot;object mode&quot; to the object's vertices you can
press &quot;ctrl+a&quot; (with the mouse hovering over the 3D-View) and choose
scale.  You will notice that the scale in &quot;object mode&quot; is back to (1,
1, 1).  Alternatively you can select this option from the menu
object-&gt;apply-&gt;scale</p>
<img alt="screenshots/object_menu.png" src="screenshots/object_menu.png" style="width: 80%;" />
</div>
</div>
<div class="section" id="building-the-model">
<h1>Building the Model</h1>
<ol class="arabic">
<li><p class="first">Start by creating a box of the dimensions 0.5 x 0.3 x 0.2 this can
be done by directly editing the object properties &quot;Dimensions&quot; in
the toolbar.</p>
</li>
<li><p class="first">Rename the object (e.g. &quot;Body&quot;) this can be done in the object
property window.</p>
<img alt="screenshots/rename_object2.png" src="screenshots/rename_object2.png" style="width: 80%;" />
</li>
<li><p class="first">Choose a color by selecting a diffuse and/or specular color in the
material property window.</p>
<img alt="screenshots/material.png" src="screenshots/material.png" style="width: 80%;" />
</li>
<li><p class="first">It is convinient to have the model on a different layer than the
camera and lights.  Therefore we move it to a different layer by
selecting everything belonging to the model (so far only the box).
Then press &quot;m&quot; and select a new layer to move the objects to that
layer.</p>
</li>
<li><p class="first">Create a sphere that will serve as a wheel.  In the Menu select
&quot;Add-&gt;Mesh-&gt;UV Sphere&quot; and name the object (e.g., &quot;Wheel.000&quot;).</p>
<img alt="screenshots/create_sphere2.png" src="screenshots/create_sphere2.png" style="width: 80%;" />
</li>
<li><p class="first">Scale the sphere to an appropriate size (we used 0.1 in all
dimensions)</p>
</li>
<li><p class="first">Position the sphere at a lower corner of the box be setting its
location parameters (e.g., x=0.25; y=-0.15; z=-0.1)</p>
</li>
<li><p class="first">Create a new material by pressing &quot;new&quot; in the material property
window</p>
<img alt="screenshots/new_material.png" src="screenshots/new_material.png" style="width: 80%;" />
</li>
<li><p class="first">Set material properties for the wheel/sphere.</p>
</li>
<li><p class="first">Set up parent-child relationship between the body and the wheel.
Select the child and the parent (in that order) and press
&quot;ctrl+p&quot;.  NOTE: If you want to break up a parent-child
relationship you should select the child object in the 3D-View and
press &quot;alt+p&quot; (while hovering the 3D-View) and select &quot;Clear and
Keep Transformation&quot;.</p>
</li>
<li><p class="first">The way we currently export joints from blender to MARS is via
helper objects that contain all relevant information (e.g., joint
and motor type, limits, etc.) in custom properties.  So go ahead
and create a arbitrary object (we usually use slim cylinders
because you can clearly see the rotation axis) and position it at
the location of the joint.  It helps if the child object of the
joint has the same origin and orientation as the joint helper
object.  Create two custom properties in the &quot;object property&quot;
window.</p>
<img alt="screenshots/joint.png" src="screenshots/joint.png" style="width: 80%;" />
<p>For the first custom property press edit to set the &quot;property
name&quot; to &quot;type&quot; and the &quot;property value&quot; to &quot;joint&quot; for the second
custom property press edit to set the &quot;property name&quot; to &quot;node2&quot;
and the &quot;property value&quot; to &quot;Wheel.000&quot; this tells the export
script that this is a helper object for a &quot;joint&quot; and that the
object on the output shaft is the &quot;Wheel.000&quot; object.  The object
on the input shaft it determined by the parent of the helper
object itself so set that to &quot;Body&quot;.</p>
</li>
<li><p class="first">By default each joint is automatically associated with a servo
motor.  To change the motor type to a PID motor you need to create
another custom property called &quot;motor_type&quot; and set its value to
&quot;2&quot; (note that you might need to increase the &quot;Max&quot; value in the
custom property)</p>
</li>
<li><p class="first">Turn the timeline into a text editor</p>
<img alt="screenshots/text_editor.png" src="screenshots/text_editor.png" style="width: 80%;" />
</li>
<li><p class="first">By selecting the menu &quot;text-&gt;Open Text Block&quot; in the text editor
open the &quot;create_mars_props.py&quot; script from
~/devel/mars/scripts/blender/</p>
</li>
<li><p class="first">Select all objects of the model in the 3d-view and run the script
by pressing &quot;Run Script&quot; in the text editor window.  You will see
that this creates various custom properties on every object.  You
are free to edit these properties (e.g. set the mass)</p>
</li>
<li><p class="first">For the wheel create two more custom properties: &quot;physicMode&quot; and
&quot;radius&quot;.  Set &quot;physicMode&quot; to &quot;sphere&quot; and &quot;radius&quot; to half the
diameter (in our case 0.05).  Otherwise the physical
representation of the wheels in the simulation would be boxes
makeing very poor wheels.</p>
</li>
<li><p class="first">Duplicate the wheel and the helper object by selecting them and
pressing &quot;shift+d&quot;.  A duplicated object will inherit the
location, orientation, material, parent, and custom properties
among other things.  By nameing the first wheel &quot;Wheel.000&quot; we
ensure consistent nameing.  Blender automatically increases the
ending to &quot;Wheel.001&quot; for the duplication.  Of course you can set
the name to what ever you like.</p>
</li>
<li><p class="first">Also create the last two remaining wheels by duplicating one of
the first.  Position the four wheels at the four lower corners of
the box.</p>
</li>
<li><p class="first">Do not forget to change the value of the &quot;node2&quot; in each of the
copied helper objects' custom property.</p>
</li>
<li><p class="first">Add the custom properties &quot;filename&quot; and &quot;path&quot; to the World and
fill in where you want to export the scene to.  Ideally, this
should be an empty directory because bside the .scn file the .obj
and .scene files are also exported for debuging purposes.</p>
<img alt="screenshots/world_properties.png" src="screenshots/world_properties.png" style="width: 80%;" />
</li>
<li><p class="first">Load the &quot;relative_mars_export.py&quot; from
~/devel/mars/scripts/blender/ in the text editor window.</p>
</li>
<li><p class="first">Select all objects of the model and run the relative_mars_export
script.</p>
</li>
<li><p class="first">Do not forget to save your blender scene.</p>
</li>
</ol>
<p>Congratulations!  You have your first blender created MARS scene.
However, if you load the scene in MARS and try to do a tank turn you
might notice that it does not work to well.  You would need to tune
the friction parameters for the wheels.  Alternatively, we add a third
pair of wheels to the model to show the workflow of editing an
existing scene.</p>
<ol class="arabic" start="24">
<li><p class="first">Reopen your blender scene if you do not have it opened any more.</p>
</li>
<li><p class="first">Duplicate a wheel pair (shift+d after selecting the parts) and
move it to the middle of the body (&quot;g&quot; for grab; &quot;x&quot; to constrain
the movement to the x-axis; &quot;0.25&quot; to move it to the middle)</p>
<img alt="screenshots/new_wheels.png" src="screenshots/new_wheels.png" style="width: 80%;" />
</li>
<li><p class="first">Adjust the custom property &quot;node2&quot; of the new joint helper objects
to let them point to the new wheels.</p>
</li>
<li><p class="first">Re-run the &quot;create_mars_props.py&quot; script.  You need to execute
this script everytime you add or remove an object to/from the
scene because it will assign unique ids to all objects and group
objects belonging together.</p>
</li>
<li><p class="first">Run the &quot;relative_mars_export.py&quot; script to update the scene.</p>
</li>
<li><p class="first">Test in MARS!</p>
</li>
</ol>
</div>
</div>
      <footer>
        <a href="http://validator.w3.org/check?uri=referer" target="_blank">
          <img src="http://www.w3.org/Icons/valid-html401"
               alt="Valid HTML 4.01 Transitional"/>
        </a>
        <a href="http://jigsaw.w3.org/css-validator/check/referer" target="_blank">
          <img src="http://jigsaw.w3.org/css-validator/images/vcss"
               alt="Valid CSS!"/>
        </a>
      </footer>
    </div>
  </body>
</html>
