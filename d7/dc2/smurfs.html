<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>SMURF / SMURFs</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../mars_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo_v2_wob.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">An open-source, flexible 3D physical simulation framework</div>
    </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d7/dc2/smurfs.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SMURF / SMURFs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>SMURF &amp; SMURF scenes</h2>
<h3>Overview</h3>
<p>SMURF is the robot description format used by MARS and an extension of URDF: it contains more information than URDF, but maintains full compatibility. Thus, discarding the additional data, it's always possible to retrieve a valid URDF from a SMURF robot representation. Check the <a href="https://github.com/rock-simulation/smurf_parser">SMURF parser</a> for details. SMURF scenes (or SMURFS) is a scene format building on the definition of SMURF, but again extending it. While the original <a class="el" href="../../d8/d08/mars_scenes.html">MARS scene</a> essentially contained every geometrical object in the scene and it was possible to have multiple robots or objects of the environment mixed in one file, SMURF scenes demand objects in the scene to be grouped as simulation <em>entities</em>. Such entities can be anything from a heightmap representing the ground to a SMURF-defined robot to simply a light source. MARS has a component called <code>EntityFactoryManager</code> (EFM) where classes implementing the <code>EntityFactory</code> interface can register one or more entity types. The <a class="el" href="../../d2/d19/classmars_1_1smurf_1_1_s_m_u_r_f_loader.html">mars::smurf::SMURFLoader</a> forwards the data in the form of a <a href="https://github.com/rock-simulation/configmaps">`ConfigMap`</a> to the EFM, which in turn passes it to the respective factories. The config map data gets stored in the <code>SimEntity</code> for later use, which allows the creation of plugins to react to user-defined custom data.</p>
<h3>SMURF</h3>
<p>The Supplementable, Mostly Universal Robot Format is a flexible format to describe the entirety of a robot. It extends URDF - which it maintains as a separate file - by annotating the URDF data in additional <a href="http://yaml.org">YAML</a> files.</p>
<p>You can find the SMURF format documentation on the <a href="http://github.com/rock-simulation/smurf_parser">GitHub repository of the SMURF parser</a>.</p>
<h3>SMURF Scenes</h3>
<h4>Creating Entities</h4>
<p>As mentioned above, SMURF scenes are built from putting together a list of entities. As most of SMURF itself (the only exception being the URDF file), SMURF scenes are encoded in <a href="http://yaml.org">YAML</a> format. The smallest example we can conjure up has a list with just one element: </p>
<pre class="fragment">entities:
  - name: Eve
    file: myrobot.smurf
</pre><p>This minimalist entry for our robot called 'Eve' contains its <em>name</em> (which will become the name of the <code>SimEntity</code> in MARS) and the URI of the SMURF <em>file</em>. As we specified no type, MARS will try to parse it from the file extension, which in the case of '.smurf' will translate to <em>smurf</em> and allow the correct <code>EntityFactory</code> to be used. However we can explicitly specify the type if we want: </p>
<pre class="fragment">entities:
  - name: Eve
    file: myrobot.smurf
    type: smurf
</pre><p>This may be helpful for users not familiar with the SMURF scene format. If we want to get Eve some company, we can now simply add a second robot to our scene, like so: </p>
<pre class="fragment">entities:
  - name: Eve
    file: myrobot.smurf
    type: smurf
  - name: Adam
    file: myrobot.smurf
    type: smurf
</pre><p>As you can see, it's entirely possible to put more than one robot based on the same SMURF file in one scene, as entities will be distinguished by their names.</p>
<h4>Placing Entities</h4>
<p>There is a problem with the above scene containing Adam and Eve: they will both be created at the global origin. Biblical references aside, this is not very practical, as it will lead to collisions that are going to ruin your simulation day. We should therefore get some distance between the two models: </p>
<pre class="fragment"># example.smurfs
# SMURF scene example

entities:
  - name: Eve
    type: smurf
    file: myrobot.smurf
    position: [5.0, 0, -0.8]    # [x, y, z]
    rotation: [1.5, 20.0, 0.0]  # euler angles: [x, y, z]
  - name: Adam
    type: smurf
    file: myrobot.smurf
    position: [-2.0, 3.5, 0]
    rotation: [0.7071, 0.0, -0.7071, 0.0]  # quaternion [w, x, y, z]
</pre><p>While position is always notated as a list of three floats, rotation can be provided as either Euler angles or a rotation quaternion - MARS will interpret the provided list of numbers according to its length. It's even possible only to specify one value (e.g. <code>rotation: [45.3]</code>), which will be interpreted as a rotation around the global Z axis.</p>
<p>As you will also have noted, you can add comments anywhere in <a class="el" href="../../d7/d1e/namespace_y_a_m_l.html">YAML</a> using <code>#</code>.</p>
<h4>Anchoring Entities</h4>
<p>Our two robots so far have been free to move around in our simulated world (though admittedly, there is no ground for them to move around on yet), but sometimes model of a robot or other entities for that matter are supposed to be static, or, "anchored to the world": </p>
<pre class="fragment"># example.smurfs
# SMURF scene example

entities:
  - name: Eve
    type: smurf
    file: myrobot.smurf
    position: [5.0, 0, -0.8]    # [x, y, z]
    rotation: [1.5, 20.0, 0.0]  # euler angles: [x, y, z]
  - name: Adam
    type: smurf
    file: myrobot.smurf
    position: [-2.0, 3.5, 0]
    rotation: [0.7071, 0.0, -0.7071, 0.0]  # quaternion [w, x, y, z]
  - name: Lazy Bob
    file: lazybot.smurf
    anchor: world
    rotation: [15]
</pre><p>This <code>anchor: world</code> statement will lead to the root link of the underlying URDF model being statically anchored in the defined position and orientation. Any joints of the anchored model will of course be movable just as expected. It can be very helpful to anchor a robot in place while debugging the model, as it will not be affected just as badly by jerky movements caused by internal collisions or similar simulation errors. But since the borders between robots and non-robot-machines are fuzzy, it also allows to build stationary machinery of your simulation environment in the SMURF format, for instance doors, levers or traffic lights, which may not move with respect to the world, but may still have moving parts or sensors. Even fully static elements of the environment such as houses or trees can be represented in SMURF and anchored in the simulation.</p>
<h4>Using Old MARS Scenes</h4>
<p>To stay backwards compatible, SMURF scenes allow to re-use old MARS scenes by simply adding them to the list of entities to be loaded. This is a very neat way to finally create some solid ground: </p>
<pre class="fragment"># example.smurfs
# SMURF scene example

entities:
  - name: Eve
    type: smurf
    file: myrobot.smurf
    position: [5.0, 0, -0.8]    # [x, y, z]
    rotation: [1.5, 20.0, 0.0]  # euler angles: [x, y, z]
  - name: Adam
    type: smurf
    file: myrobot.smurf
    position: [-2.0, 3.5, 0]
    rotation: [0.7071, 0.0, -0.7071, 0.0]  # quaternion [w, x, y, z]
  - name: Lazy Bob
    file: lazybot.smurf
    anchor: world
    rotation: [15]
  - name: Earth
    file: infinite_plane.scn  # old MARS scene
    type: scn  # optional
</pre><p>Again, as with SMURF files, MARS will derive the type from the file extension, but it doesn't hurt to specify the type explicitly, either.</p>
<h4>Adding Custom Entities</h4>
<p>SMURF scenes are easily extendable. For instance, you might feel that some nice background touch is missing in our creation and thus you wish to add an entity of type <em>rainbow</em>, for which you have just created an <code>EntityFactory</code>. Well, there you go: </p>
<pre class="fragment"># example.smurfs
# SMURF scene example

entities:
  - name: Eve
    type: smurf
    file: myrobot.smurf
    position: [5.0, 0, -0.8]    # [x, y, z]
    rotation: [1.5, 20.0, 0.0]  # euler angles: [x, y, z]
  - name: Adam
    type: smurf
    file: myrobot.smurf
    position: [-2.0, 3.5, 0]
    rotation: [0.7071, 0.0, -0.7071, 0.0]  # quaternion [w, x, y, z]
  - name: Lazy Bob
    file: lazybot.smurf
    anchor: world
    rotation: [15]
  - name: Earth
    file: infinite_plane.scn  # old MARS scene
    type: scn  # optional
  - name: rainbow1
    file: environment/rainbow.yaml
    type: rainbow
    position: [1500.0, 300.0, 270.0]
    rotation: [37.5]
</pre><p>Provided that you have entered your library with the <code>EntityFactory</code> for *rainbow*s in the other_libs.txt file in your MARS configuration folder, MARS will pass the information to your plugin and thus your new entity will be integrated in the scene.</p>
<blockquote class="doxtable">
<p><b>NOTE</b>: The parameters <em>position</em> and <em>rotation</em> are not required to define a valid <code>SimEntity</code>. You may create a rather abstract entity for which you don't need these variables. However if your entity is supposed to be located somewhere in the scene and you therefore want to create it at a provided position and orientation, you have to implement this functionality yourself in your <code>EntityFactory</code> class.</p>
<p></p>
</blockquote>
<p>You will have recognized that the file extension for our custom rainbow entity is '.yaml'. We do not recommend to use file extensions as a way to substitute custom types, as types such as <code>my_special_kind_of_entity</code> are rather unwieldy in filenames. This is especially important since we encourage users to use specialized and verbose entity types, as this helps to mitigate the problem of type name conflicts. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Mar 23 2015 17:21:53 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
