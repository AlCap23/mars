<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>MARS: Data Broker</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../mars_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo_v2_wob.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MARS
   </div>
   <div id="projectbrief">An open-source, flexible 3D physical simulation framework</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d2/d69/data_broker.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Data Broker </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Overview</h2>
<p>The data_broker library provides functionality to manage data transfer between the components of the MARS simulation. Its interface is defined in the class <a class="el" href="../../d6/d2e/classmars_1_1data__broker_1_1_data_broker_interface.html">DataBrokerInterface</a>, while the <a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html">DataBroker</a> class is the actual implementation.</p>
<h2>Producers and receivers</h2>
<p>An instance of DataBroker passes data between registered producers and receivers (see ProducerInterface and <a class="el" href="../../d0/d0e/classmars_1_1data__broker_1_1_receiver_interface.html">ReceiverInterface</a>, respectively) in the MARS framework. For this purpose it holds buffered local copies of the data packages and is thus able to coordinate data transfer between various threads.</p>
<p>Consequently, there are a number of ways in which data can be handled. and for this purpose holds a local copy of the data. For this purpose, the <a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html">DataBroker</a> calls the functions produceData and receiveData of the classes implementing the respective interfaces. When this happens is determined by the way the producer/receiver is registered with the <a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html">DataBroker</a>. While producers can only be registered as timed producers (using a previously created timer, either manually defined - see <a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html#a9f8177fae2f850cc0fe9cba02074f713">createTimer</a> - or using the DataBroker's real time Timer which is automatically created if a producer is registered with a "_realTime_" timer), receivers can be registered in four different ways:</p>
<ol type="1">
<li>timed</li>
<li>triggered</li>
<li>asynchronous</li>
<li>synchronous</li>
</ol>
<h3>Timed receivers</h3>
<p>A timed receiver's receiveData function is called by the stepTimer function of the timer (managed by the DataBroker) with which it was registered. To create a timed receiver one has to do the following:</p>
<ul>
<li>call createTimer() with a suitable name</li>
<li>call registerTimedReceiver() with a desired update period</li>
<li>call stepTimer() to step the timer and get the updates</li>
</ul>
<p>The first step can be omitted if an appropriate timer already exists.</p>
<p>NOTE: You will get the latest datum, regardless of whether it has been updated or not since the last timer step.</p>
<h3>Triggered receivers</h3>
<p>To create a triggered receiver, which is receiving data as a result of a called trigger, the following steps are necessary:</p>
<ul>
<li>call createTrigger() with a suitable triggerName</li>
<li>call registerTriggered() to register to a certain trigger</li>
<li>call trigger() to manually trigger a certain trigger and update all receivers registered to it</li>
</ul>
<p>As with timed receivers, one only has to create a new trigger if no appropriate trigger exists already.</p>
<p>NOTE: You will get the latest datum, regardless of whether it has been updated or not since the last trigger call.</p>
<h3>Asynchronous receivers</h3>
<p>Asynchronous receivers are updated asynchronously whenever the run() method of the DataBroker is called (which is typically by the MARS simulation), i.e. are not synchronized with the producers which provide the data they receive. This means that if the producer updates with a higher frequency than the receiver, only the last datum is received.</p>
<p>This can be the case if the producer it called from a timer with a higher frequency than whichever thread processes the data of the AsyncReceiver. It can also be the case if data are pushed to the DataBroker via pushData() with a higher frequency.</p>
<ul>
<li>call registerAsyncReceiver() with (sensor group and name)</li>
</ul>
<h3>Synchronous receivers</h3>
<p>Synchronous receivers are updated synchronously to the thread which calls pushData. This should only be used if it is important that no datum is missed, as it might otherwise slow down whichever process pushes the data.</p>
<p>: not clear in this context if synchronous receivers will receive data if there is noone pushing the data</p>
<ul>
<li>call registerSyncReceiver() with (sensor group and name)</li>
</ul>
<h3>Typical use cases</h3>
<p>1) Plotter: should run in Asynchronous or Timed mode 2) File Logger: should run in Asynchronous or Timed mode 3) Controller: should probably run in Asynchronous mode. 4) Command: When listening for commands you should run in Synchronous mode.</p>
<h2>Data formats</h2>
<p>Data is managed by the DataBroker library in the form of a <a class="el" href="../../da/d2f/classmars_1_1data__broker_1_1_data_package.html">DataPackage</a> which itself contains a number of instances of <a class="el" href="../../dc/d14/classmars_1_1data__broker_1_1_data_item.html">DataItem</a>. The latter is a wrapper class for variables of any of the following types:</p>
<ul>
<li>int</li>
<li>long</li>
<li>float</li>
<li>double</li>
<li>string</li>
<li>bool</li>
</ul>
<p>contained in an <code>std::vector</code> named <code>package</code>. The field <code>name</code> contains a string describing the <a class="el" href="../../dc/d14/classmars_1_1data__broker_1_1_data_item.html">DataItem</a>.</p>
<p>The class <a class="el" href="../../da/d2f/classmars_1_1data__broker_1_1_data_package.html">DataPackage</a> is a container for multiple instances of <a class="el" href="../../dc/d14/classmars_1_1data__broker_1_1_data_item.html">DataItem</a>. These can be added to a package and afterwards accessed either by name (getItemByName) or by index (getItemByIndex). Also, the method getType allows to read the type of a <a class="el" href="../../dc/d14/classmars_1_1data__broker_1_1_data_item.html">DataItem</a> either by index or name as well.</p>
<h2>Important functions</h2>
<p><a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html#a74b0bfb01ce47441d633c4916034400f">pushData</a></p>
<p>This function allows to easily write data to the DataBroker without the need of implementing the DataProducerInterface first. As long as the used names or consistent (or better, the initially received ID is used), the DataBroker will overwrite the pushed DataPackage. This can be used, e.g., for testing purposes, or in general when handling asynchronous receivers. Another useful application is communication between libraries: A library can push an initial DataPackage and then register itself as a receiver of that package. If updates are made to the data by any other library, the first one will be notified.</p>
<p><a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html#a9a6a5f45f5501ddaed67b9d3c24c39ac">stepTimer</a></p>
<p>This function can be called from outside of DataBroker to step any previously created timer. It is also called from within DataBroker to step its own "\_realtime\_" thread which in turn is activated by <a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html#ad094a6183d8fcc0161ccff0695b9a45c">runRealtime</a>.</p>
<p><a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html#a8b5a5e00221305b863b0323ad389993f">run</a></p>
<p>This function handles asynchronous receivers and has to be called from another thread than the data producers.</p>
<p><a class="el" href="../../d7/d09/classmars_1_1data__broker_1_1_data_broker.html#ad094a6183d8fcc0161ccff0695b9a45c">runRealtime</a></p>
<p>This function activates the "\_realtime\_" timer of a DatBroker, thus handling synchronous receivers as well as timed receivers and producers registered with the timer.</p>
<p>[27.09.2013] </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Mar 2 2015 17:29:44 for MARS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
