Masses and Inertia

It's important for simulation models to have a similar or preferably identical mass distribution as the original model. Editing a model in Blender, this can become quite tricky, but the simplest method is to assign the masses to the actual visual objects representing the robot, as they can be easily identified. Now URDF, in which we want to export, does not support masses for visual objects. It does not even support masses for collision objects which are, after all, physical. What URDF does is demand the specification of one mass per link (specified in a separate inertial object), so that masses of several physical objects belonging to that link have to be combined. URDF further demands, if there is an inertial object in the link, that it further defines the resulting inertia matrix and optionally a center of mass location different from the origin. The obvious implementation of this is to provide a separate, positionable inertia object in Blender, with attributes mass (float) and inertia (string containing 6 floats representing the upper half of the inertia matrix). This is in fact the only way to get inertial data in URDF.
It is not the only way to specify inertial data, though. Masses can be specified in both visual objects and collision objects. For collision objects automatically generated from visual objects, the masses can also be syncronized. Thus it is possible to update a model's masses using its visual objects and add extra masses with dummy collision objects to represent internally located batteries and such. These additional collision elements are taken into account when the total mass of the link is calculated.
Note that syncing can be done in three ways: visual → collision, collision → visual and latest → older, thus checking which mass had been changed last for each pair of visual and collision object. Be careful as only selected objects are being synced, however if only the visual or only the collision object of a pair are selected, their partners get selected as well.
This way, the collision objects of a link always contain the latest and full information on mass and since they represent simulated geometry, it is also possible to derive the inertia matrix of the entire link from its collision objects.
